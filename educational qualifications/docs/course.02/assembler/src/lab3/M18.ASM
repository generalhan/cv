;-----------------------------------------------------------------------------
;-----------------    -------------------------
;-----------------------------------------------------------------------------
.MODEL SMALL
.STACK 100H
.DATA
 ;----------------------------------------------------------------------------
 KI DW 0             ; 16-    
 ;----------------------------------------------------------------------------
 GLOBAL CD:WORD
 GLOBAL I:WORD
 GLOBAL MAS:WORD
 GLOBAL XYMAS:WORD
 GLOBAL USER_ACTIV_WINDOW:PROC
 GLOBAL FLEG:WORD
.386
.CODE
 EXTRN TUTOR:NEAR
 EXTRN OTOBRAGENIE_ACTIV_WINDOW:NEAR
 EXTRN PROBERKA_ZAKRITIE:NEAR
;-------------------------- ----------------------------------------
USER_ACTIV_WINDOW PROC
       ;----------------------------------------------------------------------
       ;-------     -  -------
       ;-------   CD=2..8 (CD<>0 OR CD<>1)-------------------
       ;----------------------------------------------------------------------
       CMP CD,2
       JGE METKA  
       JMP NEAR:EXIT_USER_ACTIV_WINDOW
        ;---------------------------------------------------------------------
        METKA:
        XOR DI,DI
        XOR SI,SI
        MOV BX,CX                    ; BX-  
        ;--------
        MOV I,0                           ;,    
        ;--------
        MOV CX,CD
        LEA SI,MAS
        ADD SI,XYMAS              
        SUB SI,2                  ;MAS[SI]=DI-    
        MOV KI,SI
        ;---------------------------------------------------------------------
        ;--        MAS------
        ;---  MAS      
        ;---------------------------------------------------------------------
        POISK_ACTIV_OKNO:
                         ;----------------------------------------------------
                         MOV SI,KI ;KI-    
                         MOV DI,[SI]
                         SUB SI,2
                         MOV KI,SI                                              
                         ;-----------------  ------------------
                         PUSH AX
                         MOV AX,2
                         CMP [DI+20],AX
                         POP AX
                         ;-----------------    -----------
                         JE WINDOW_CLOSE
                         ;------------,    ----------------
                         INC I
                         CMP BX,[DI]   ;X1
                         JL NET
                         CMP DX,[DI+2] ;Y1
                         JL NET
                         CMP BX,[DI+4] ;X2
                         JG NET
                         CMP DX,[DI+6] ;Y2
                         JG NET
                         ;--    -    ----
                         CALL TUTOR
                         CMP FLEG,1
                         JE NET_SORTIROBKA
                         ;---------     -------------
                         CALL OTOBRAGENIE_ACTIV_WINDOW
                         ;----------------------------------------------------
                         ;    -  MAS
                         MOV AX,I
                         CMP AX,1
                         JLE NET_SORTIROBKA
                         ;----------------------------------------------------
                         CALL SORTIROBKA
                         ;-----    - -------
                         JMP NET_SORTIROBKA
                         ;----------------------------------------------------
                         NET:
        LOOP POISK_ACTIV_OKNO
        ;---------------------------------------------------------------------
        NET_SORTIROBKA:CALL PROBERKA_ZAKRITIE
        JMP WINDOW_CLOSE
        ;---------------------------------------------------------------------
        ;--------- CD=1,        -------------
        ;---------------------------------------------------------------------
        EXIT_USER_ACTIV_WINDOW:
                               LEA SI,MAS
                               MOV DI,[SI]
                               MOV BX,CX
                               CALL TUTOR
        WINDOW_CLOSE:RET
USER_ACTIV_WINDOW ENDP
;-----------------------------------------------------------------------------
;----------------------------- ------------------------------
;---------------------     MAS---------------------
;-----------------------------  --------------------------
;-----------------------------------------------------------------------------
SORTIROBKA PROC
               ;--------------------------------------------------------------
               MOV AX,DI                                 ; 
               PUSH AX
               MOV CX,I
               DEC CX
               ;--------------------------------------------------------------
               LEA SI,MAS
               MOV AX,CD
               SUB AX,I
               IMUL AX,2
               ADD SI,AX
               CIKL:
                    MOV BX,[SI+2]
                    MOV [SI],BX
                    ADD SI,2
               LOOP CIKL
               ;----    DI  --------------
               LEA SI,MAS
               MOV AX,CD
               IMUL AX,2
               ADD SI,AX
               POP AX
               SUB SI,2
               MOV [SI],AX
            RET
SORTIROBKA ENDP
;-----------------------------------------------------------------------------
END

