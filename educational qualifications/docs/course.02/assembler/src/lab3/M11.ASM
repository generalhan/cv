;-----------------------------------------------------------------------------
;------------------åéÑìãú èÖêÖÑÇàÜÖçàü éäéç çÄ ÑàëèãÖÖ------------------------
;-----------------------------------------------------------------------------
.MODEL SMALL
.STACK 100H
 OKNO STRUC
 X1 DW 0     ;[DI]
 Y1 DW 0     ;[DI+2]
 X2 DW 0     ;[DI+4]
 Y2 DW 0     ;[DI+6]
 COLOR DW 30 ;[DI+8]                            
 NUMBER DW 0 ;[DI+10]
 CURX DW 1   ;[di+12]
 CURY DW 1   ;[di+14] 
 BUF DW 0    ;[di+16]
 POLOGENEI_KURSORA DW 0    ;[DI+18] - èéãéÜÖçàÖ äìêëéêÄ Ç éäçÖ
 OPEN_OR_CLOSE_WINDOW DW 0 ;[DI+20]    
 OKNO ENDS
.DATA
 ;----------------------------------------------------------------------------
 GLOBAL PAR1:WORD
 GLOBAL PAR2:WORD
 GLOBAL PAR3:WORD
 GLOBAL PAR4:WORD
 GLOBAL PAR5:BYTE
 GLOBAL PAR6:WORD
 ;----------------------------------------------------------------------------
 GLOBAL MAS1:OKNO
 ;----------------------------------------------------------------------------
 DELX DW 0
 DELY DW 0
 ;----------------------------------------------------------------------------
 GLOBAL CX_1:WORD
 GLOBAL DX_1:WORD
 ;----------------------------------------------------------------------------
 ERC DW 0 ;Ñãü ÇêÖåÖççéÉé ïêÄçÖçàü êÖÉàëíêÄ CX
 ERD DW 0 ;Ñãü ÇêÖåÖççéÉé ïêÄçÖçàü êÖÉàëíêÄ DX
 ;----------------------------------------------------------------------------
 GLOBAL CLICK_MOUSE_FLAG_TRUE:PROC
.386
.CODE
 EXTRN PROCEDURE_MAS:NEAR
 EXTRN WINDOW_STIR:NEAR
 EXTRN WINDOW:NEAR
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------
;------------------------íÖãé åéÑìãü------------------------------------------
;-----------------------------------------------------------------------------
;-----------------------------------------------------------------------------
CLICK_MOUSE_FLAG_TRUE PROC
        ;---------------------------------------------------------------------
        MOV ERC,CX                             ;ëéïêÄçüÖå êÖÉàëíê Ç èÖêÖåÖççéâ
        SUB CX,CX_1
        MOV DELX,CX
        ;----------
        MOV ERD,DX                             ;ëéïêÄçüÖå êÖÉàëíê Ç èÖêÖåÖççéâ
        SUB DX,DX_1
        MOV DELY,DX
        ;--------------------íÖäìôÖÖ éäçé-------------------------------------
        CALL PROCEDURE_MAS
        ;---------------------------------------------------------------------
        DVIGENIE_OKON:
                    MOV AX,[DI+2]
                    MOV PAR1,AX
                    MOV AX,[DI+6]
                    MOV PAR2,AX
                    MOV AX,[DI]
                    MOV PAR3,AX
                    MOV AX,[DI+4]
                    MOV PAR4,AX
                    MOV AX,0
                    MOV WORD PTR PAR5[SI],AX
                    MOV AX,[DI+10]
                    MOV PAR6,AX
                    CALL WINDOW_STIR
                    ;---------------------------------------------------------
                    ;-----------èêÖéÅêÄáìå äééêÑàçÄíõ-------------------------
                    ;---------------------------------------------------------
                    MOV AX,[DI]
                    ADD AX,DELX
                    MOV [DI],AX
                    MOV AX,[DI+4]
                    ADD AX,DELX
                    MOV [DI+4],AX
                    ;---------
                    MOV AX,[DI+2]
                    ADD AX,DELY
                    MOV [DI+2],AX
                    MOV AX,[DI+6]
                    ADD AX,DELY
                    MOV [DI+6],AX
                    ;---------èêéÇÖêäÄ çÄ ÇõïéÑ àá ÑàÄèÄáéçÄ------------------
                    MOV AX,[DI+2]
                    CMP AX,3
                    JGE DOOM
                    ;--------------Öëãà ÑÄ, íé äééêÑàçÄíõ çÄáÄÑ---------------
                    MOV AX,[DI]
                    SUB AX,DELX
                    MOV [DI],AX
                    MOV AX,[DI+4]
                    SUB AX,DELX
                    MOV [DI+4],AX
                    ;---------
                    MOV AX,[DI+2]
                    SUB AX,DELY
                    MOV [DI+2],AX
                    MOV AX,[DI+6]
                    SUB AX,DELY
                    MOV [DI+6],AX
                    JMP DOO
                    DOOM:
                    ;---------------------------------------------------------
                    ;---------------------------------------------------------
                    MOV AX,[DI+2]
                    CMP AX,12
                    JLE DOOM@
                    ;---------------------------------------------------------
                    MOV AX,[DI]
                    SUB AX,DELX
                    MOV [DI],AX
                    MOV AX,[DI+4]
                    SUB AX,DELX
                    MOV [DI+4],AX
                    ;---------
                    MOV AX,[DI+2]
                    SUB AX,DELY
                    MOV [DI+2],AX
                    MOV AX,[DI+6]
                    SUB AX,DELY
                    MOV [DI+6],AX
                    JMP DOO
                    DOOM@:
                    ;---------------------------------------------------------
                    ;---------------------------------------------------------
                    MOV AX,[DI]
                    ADD AX,65
                    CMP AX,80
                    JLE DOOM@@
                    ;---------------------------------------------------------
                    MOV AX,[DI]
                    SUB AX,DELX
                    MOV [DI],AX
                    MOV AX,[DI+4]
                    SUB AX,DELX
                    MOV [DI+4],AX
                    ;---------
                    MOV AX,[DI+2]
                    SUB AX,DELY
                    MOV [DI+2],AX
                    MOV AX,[DI+6]
                    SUB AX,DELY
                    MOV [DI+6],AX
                    JMP DOO
                    ;---------------------------------------------------------
                    ;---------------------------------------------------------
                    DOOM@@:
                    MOV AX,[DI]
                    CMP AX,2
                    JGE DOO
                    ;---------------------------------------------------------
                    MOV AX,[DI]
                    SUB AX,DELX
                    MOV [DI],AX
                    MOV AX,[DI+4]
                    SUB AX,DELX
                    MOV [DI+4],AX
                    ;---------
                    MOV AX,[DI+2]
                    SUB AX,DELY
                    MOV [DI+2],AX
                    MOV AX,[DI+6]
                    SUB AX,DELY
                    MOV [DI+6],AX                                
                    ;---------------------------------------------------------
                    ;---------------------------------------------------------                    
                    DOO:
                    MOV AX,[DI+2]
                    MOV PAR1,AX
                    MOV AX,[DI+6]
                    MOV PAR2,AX
                    MOV AX,[DI]
                    MOV PAR3,AX
                    MOV AX,[DI+4]
                    MOV PAR4,AX
                    MOV AX,[DI+8]
                    MOV WORD PTR PAR5[SI],AX
                    MOV AX,[DI+10]
                    MOV PAR6,AX
                    CALL WINDOW
       ;----------------------------------------------------------------------
       MOV DX,ERD
       MOV DX_1,DX  ;áÄèéåàçÄÖå íÖäìôìû äééêÑàçÄíì CX
       MOV CX,ERC
       MOV CX_1,CX  ;áÄèéåàçÄÖå íÖäìôìû äééêÑàçÄíì CX
       RET
CLICK_MOUSE_FLAG_TRUE ENDP
;-----------------------------------------------------------------------------
END
