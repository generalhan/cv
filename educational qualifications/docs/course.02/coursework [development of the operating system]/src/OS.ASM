.MODEL TINY
.CODE 
     ORG 100H
START:
     JMP NEAR:DATA_OS
       ;----------------------------------------------------------------------
       COMER DB 'COMMAND:'
       NAN DB 'OSBT'
       EDIT_I DW 0
       ;----------------------------------------------------------------------
       DH_PIKI DB 0
       puti dw 0
       DH_KOREN_OR_NE_KOREN DB 0
       KAM DW 0
       ;----------------------FOLDER_CREATE-----------------------------------
       NAMER            DB 8 DUP (0)                                              
       FOLDER_MAS       DW 100 DUP (0)
       I                DB 0
       FLAG_ONE         DB 0
       I_FOLD           DW 0            
       TEC_UK           DW 0             
       FLAG_PROVERKA_FOLDER DB 0
       UK               DW 0
       I_F              DW 0                              ;CHISLO BUKV V FAILE
       ;----------------------------MAIN--------------------------------------
       KORE             DW 0
       PAPKI            DW 100 DUP (0)
       PAP              DW 0
       UKI              DW 0
       AX_PAP           DW 0            ;ìäÄáÄíÖãú çÄ èÄèäì, çÄ äéíéêìû çÄÜÄãà
       DL1              DB 2
       DH_PIC           DB 2
       M                DW 0
       M1               DW 0
       XAL              DB 0
       XAH              DB 0                  
       ;--------------------CREATE_NEW_SECTOR---------------------------------
       WI               DW 0
       FLAG_NEW_SECTOR  DB 0
       NEW_SECTOR       DW 0
       ;--------------------SECTOR_ONE----------------------------------------
       JIK              DW 0
       SEC              DW 0
       SECTOR_MAS       DW 0
       ;--------------------FAT_PROC_WRITE_BEGIN_OS---------------------------
       J                DW 0
       ;-----------------FAT_PROPIS_SEVEN_BAIT--------------------------------
       MAS              DB 10000 DUP (0) 
       MAS_COPY         DB 10000 DUP (0)           
       ;----------------------POISK_FAT---------------------------------------
       FLAG_POISK_FAT   DB 0
       MOSK             DW 100 DUP (0)
       I_P              DB 0
       ONE_P            DB 0
       X                DW 0
       FLAG_FAT         DB 0
       ;------------------------MAS_NUMBER------------------------------------
       ROT              DW 0                       
       ;--------------------------READ_MEMORY---------------------------------  
       SLOBO            DW 0                           
       ;-------------------------PIKI_PROC------------------------------------ 
       PIKI             DB 0       
       ;----------------------NIL_FILE---------------------------------------- 
       STROL            DB '...   ' 
       ;---------------------SECTOR-------------------------------------------
       DOR              DB 0
       STOR             DB 0
       SECT             DB 0
       ;---------------------ANALIZ-------------------------------------------
       UCASATEL_SECTOR  DW 0
       FLAG             DB 0
       ;---------------------ADD_2_BAIT---------------------------------------
       ID               DB 0
       ;----------------------ADAS_PROC---------------------------------------
       S6               DB 'A:\'
       S7               DB '...'                  
       ;----------------------------------------------------------------------
       MEMORY_PUT DB 70 DUP (0)             
       MP DW 0
       CONST_MP EQU 70
       ;----------------------------------------------------------------------
       FLAG_PROVERKA_EDIT DB 0
       ;-----------------------------------éë çéÇÄü---------------------------
       BUFER_EDIT DB 1638 DUP (0)  ;ÅìîÖê Ñãü êÖÑÄäíéêÄ (1638 ÅÄâí)  
       BUFER_COM DB 60 DUP (0) 
       FAT              DB 3072 DUP (0)  
       UKBUL DW 0 
     DATA_OS:
     ;------------------------------------------------------------------------
     ;-----------------ìëíÄçÄÇãàÇÄÖå ÇàÑÖéêÖÜàå-------------------------------
     ;------------------------------------------------------------------------
     MOV AH,00H
     MOV AL,02H
     INT 10H
     ;------------------------------------------------------------------------
     ;-----------------------ìÅàêÄÖå äìêëéê ë ùäêÄçÄ--------------------------
     ;------------------------------------------------------------------------
     MOV AH,02H
     XOR BX,BX
     MOV DH,26
     MOV DL,0
     INT 10H
     ;------------------------------------------------------------------------
     ;---------------------óàíÄÖå Ç èÄåüíú íÄÅãàñì FAT------------------------
     ;------------------------------------------------------------------------
     CALL READ_FAT   
     ;------------------------------------------------------------------------
     ;-------------óàíÄÖå ëéÑÖêÜàåéÖ äéêçÖÇéÉé äÄíÄãéÉÄ Ç èÄåüíú--------------
     ;------------------------------------------------------------------------
     MOV AX,65
     ;--------
     MOV 310H+UK,AX
     ;-------------
     MOV 310H+UKI,AX               ;ÇçÄóÄãÖ PAPKI äéêçÖÇéâ äÄíÄãéÉ ë 65 ëÖäíéêÄ
     CALL READ_MEMORY
     ;---------------
     MOV 310H+KORE,1                               ;ÑÄ, ÇõÇéÑàå äéêçÖÇìû èÄèäì
     MOV 310H+DH_KOREN_OR_NE_KOREN,2      ;ÇõÇéÑàå ë 2 ëíêéäà, í.ä. ùíé äéêÖçú
     MOV 310H+M1,1
     CALL PAPKA
     ;------------------------------------------------------------------------
     ;--------------------------------êàëìÖå àçíÖêîÖâë------------------------
     ;------------------------------------------------------------------------
     CALL NAM
     CALL RAMA
     CALL COMD
     CALL DVET
     ;------------------------------------------------------------------------
     MOV 310H+DH_PIC,2
     MOV 310H+PIKI ,2                             ;ÇõÇéÑ Çé 2 ëíêéäÖ ìäÄáÄíÖãü
     CALL PIKI_PROC 
     ;------------------------------------------------------------------------
     ;-----------------------ÉãÄÇçõâ ñàäã èêéÉêÄååõ---------------------------
     ;------------------------------------------------------------------------
     MAIN_CIKL:
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////
              ;                 +   ÜÑÖå çÄÜÄíàü äãÄÇàòà   +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              MOV AH,11H
              INT 16H
              JNZ ES_KLAVA
              JMP NEAR:TIMER@
              ;---------------ÑÄ, çÄÜÄãà äãÄÇàòì------------------------------
              ES_KLAVA: 
                       MOV AL,00
                       MOV AH,10H
                       INT 16H
                       MOV 310H+XAL,AL
                       MOV 310H+XAH,AH
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////
              ;                 +   èêéÇÖêäÄ ENTER   +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              CMP AH,1CH
              JE N_ENTER
                        JMP NEAR:NET_ENTER
              N_ENTER:
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////
              ;                 +    çÄÜÄãà ENTER    +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              ;----------çÄÜÄãà çÄ ENTER - ëéáÑÄíú èÄèäì àãà Çéâíà Ç èÄèäì----     
              ;-------èêéÇÖêäÄ çÄ ëéáÑÄçàÖ çéÇéâ èÄèäà------------------------
              CALL PROVERKA_CREATE_FOLDER
              CMP 310H+FLAG_PROVERKA_CREATE_FOLDER,1
              JNE NET_CREATE_FOLDER
                 CALL OCHISTKA_MAS
                 CALL READ_MEMORY                  ;UK - ìÜÖ çÄòÖãëü èêà ÇÇéÑÖ
                 CALL FOLDER_CREATE                             ;ëéáÑÄãà èÄèäì
                 CALL PAPKA
                 JMP MAIN_CIKL
              ;-------çÖí, åõ çÖ ëéÅàêÄÖåëü ëéáÑÄÇÄíú çéÇéâ èÄèäà-------------     
              NET_CREATE_FOLDER:
                                MOV AX,310H+M1
                                ADD AX,310H+M
              ;-------------AX - èÄèäÄ, çÄ äéíéêìû çÄÜÄãà---------------------
              MOV 310H+AX_PAP,AX
              CMP AX,0                                                               
              JE EXIT_PAPKA@
              ;---------------------------------------------------------------
              ;---------------------åõ ÇïéÑàå Ç èÄèäì-------------------------      
              ;---------------------------------------------------------------
              CALL PRED_UK_MEMORY     ;áÄèéåàçÄÖå ìäÄáÄíÖãú êéÑàíÖãúëäéâ èÄèäà
              CALL POISK_AX_UKAZATAL   
              MOV 310H+UK,AX
              ;---------------------
              ;äÄäìû èÄèäì ÇõÇéÑàíú?
              ;---------------------
              CMP AX,65                     ;Öëãà 8 ëÖäíéê - íé äéêçÖÇìû èÄèäì
               JNE EXI_KOREN@
                 MOV 310H+DH_KOREN_OR_NE_KOREN,2
                 MOV 310H+KORE,1               ;ÑÄ, åõ Çéòãà Ç ÉãÄÇçõâ äÄíÄãéÉ
                 MOV 310H+M1,1
                 JMP ES_EXI_KOREN@
               EXI_KOREN@:
                 MOV 310H+DH_KOREN_OR_NE_KOREN,3
                 MOV 310H+KORE,0
                 MOV 310H+M1,0
               ES_EXI_KOREN@:
              ;---------------
              CALL OCHISTKA_MAS
              CALL READ_MEMORY                 ;óàíÄÖå èÄèäì ÑéóÖêçûû Ç èÄåüíú
              CALL STIR_DISPLEI
              MOV 310H+M,0
              CALL PAPKA
              ;--------------
              MOV 310H+DH_PIC,2
              MOV 310H+PIKI,2
              CALL PIKI_PROC
              JMP MAIN_CIKL
              ;---------------------------------------------------------------
              ;-------------------åõ ÇõïéÑàå àá èÄèäà-------------------------
              ;---------------------------------------------------------------
              EXIT_PAPKA@:
              CALL SLED_UK_MEMORY;ÇéëëíÄçÄÇãàÇÄÖå ìäÄáÄíÖãú êéÑàíÖãúëäéâ èÄèäà
                                       ;ÇõïéÑ èÄèäà AX=ìäÄáÄíÖãú çÄ êéÑ. èÄèäì
              MOV 310H+UK,AX
              ;---------------------------------------------------------------
              ;-----------------äÄäìû èÄèäì ÇõÇéÑàíú?-------------------------
              ;---------------------------------------------------------------
              CMP AX,65
               JNE EXI_KOREN
                 MOV 310H+DH_KOREN_OR_NE_KOREN,2
                 MOV 310H+KORE,1                 ;ÑÄ, åõ Çéòãà Ç ÉãÄÇçõâ äÄíÄãéÉ
                 MOV 310H+M1,1
                 JMP ES_EXI_KOREN
               EXI_KOREN:
                 MOV 310H+DH_KOREN_OR_NE_KOREN,3
                 MOV 310H+KORE,0
                 MOV 310H+M1,0
               ES_EXI_KOREN:
              ;---------------------------------------------------------------
              CALL READ_MEMORY                 ;óàíÄÖå èÄèäì ÑéóÖêçûû Ç èÄåüíú
              CALL STIR_DISPLEI
              MOV 310H+M,0
              CALL PAPKA
              ;---------
              MOV 310H+DH_PIC,2
              MOV 310H+PIKI,2
              CALL PIKI_PROC                     
              JMP MAIN_CIKL
              NET_ENTER:
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////                      
              ;              +    èêéÇÖêäÄ Ççàá àãà ÇÇÖêï    +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              CALL BN_OR_BB
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////                     
              ;               +    ÇÇéÑ Ç äéåÄçÑçìû ëíêéäì    +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              ;----------áÄôàíÄ éí èéëíêéççàï äãÄÇàò--------------------------
              ;---------------------------------------------------------------
              CMP 310H+XAH,1DH
              JNE NET_CTRL
                           JMP NEAR:MAIN_CIKL
              NET_CTRL:
              ;---------------------------------------------------------------
              CMP 310H+XAH,47H
              JGE NET_@@
                        JMP OK_BBOD
              NET_@@:
                     CMP 310H+XAH,53H
                     JLE NET_@@@
                                JMP OK_BBOD
                     NET_@@@:
                                JMP NEAR:MAIN_CIKL
              ;---------------------------------------------------------------
              OK_BBOD:
              CMP 310H+XAH,3BH
              JGE NET_@@@@
                          JMP OK_BBOD1
              NET_@@@@:
                      CMP 310H+XAH,44H
                      JLE NET_@@@@@
                                   JMP OK_BBOD1
                      NET_@@@@@:
                                   JMP NEAR:MAIN_CIKL
              ;---------------------------------------------------------------
              OK_BBOD1:
              CMP 310H+XAH,85H
              JNE NET_F11
                          JMP NEAR:MAIN_CIKL
              NET_F11:
              CMP 310H+XAH,86H
              JNE NET_F12
                          JMP NEAR:MAIN_CIKL
              NET_F12:              
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////                      
              ;                +   èêéÇÖêäÄ çÄ çÄÜÄíàÖ BS  + 
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              CMP 310H+XAH,0EH
              JE ES_BS
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////                      
              ;                 +    çÖ çÄÜàåÄãà BS   +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              CMP 310H+UKBUL,54
              JE NET_UKBIL
                  MOV BX,0B800H
                  MOV ES,BX
                  ;------------------
                  MOV SI,310H+OFFSET BUFER_COM
                  ADD SI,310H+UKBUL
                  MOV CS:[SI],AL
                  ;-------------
                  INC 310H+UKBUL
                  MOV AH,7
                  MOV CX,54
                  MOV SI,310H+OFFSET BUFER_COM
                  MOV DI,3856
                  CIKL_CO:
                      MOV AL,CS:[SI]
                      MOV ES:[DI],AX
                      INC SI
                      ADD DI,2
                  LOOP CIKL_CO
                  ;-----------------------------------------------------------
              NET_UKBIL:
              JMP NEAR:MAIN_CIKL
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////                      
              ;                  +     çÄÜÄãà BS     +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              ES_BS:
                  ;------------èêéÇÖêäÄ çÄ ñÖãéëíçéëíú------------------------
                  CMP 310H+UKBUL,0
                  JNE ES11
                     JMP NEAR:MAIN_CIKL
                  ES11:
                  ;-----------------------------------------------------------
                  MOV BX,0B800H
                  MOV ES,BX
                  ;------------------
                  MOV SI,310H+OFFSET BUFER_COM
                  DEC 310H+UKBUL
                  ADD SI,310H+UKBUL
                  MOV AL,0
                  MOV CS:[SI],AL
                  ;-------------                 
                  MOV AH,7
                  MOV CX,54
                  MOV SI,310H+OFFSET BUFER_COM
                  MOV DI,3856
                  CIKL_CO1:
                      MOV AL,CS:[SI]
                      MOV ES:[DI],AX
                      INC SI
                      ADD DI,2
                  LOOP CIKL_CO1
                  JMP MAIN_CIKL
                  ;-----------------------------------------------------------
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////                      
              ;                +     èéäÄáÄãà ÇêÖåü    +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              TIMER@:
                    CALL TIMER
              NET_ES:
     JMP NEAR:MAIN_CIKL
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;/////////////////////////////////////////////////////////////////////////////
;                     éëçéÇçõÖ èêéñÖÑìêõ èêéÉêÄååõ
;/////////////////////////////////////////////////////////////////////////////
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
FINGER PROC
     MOV SI,310H+OFFSET FAT
     MOV CX,2880
     MOV DL,2
     MOV DH,2
     CIKL_FINGER:
         PUSH CX
          MOV AL,CS:[SI]
          CMP AL,1
          JNE NET_FINGER
          ;----------------ÑÄ, ùíéí ëÖäíéê áÄçüí------------------------------
          MOV AL,31H
          MOV AH,7
          MOV CX,1
          CALL SIMBOL
          INC DL
          ;-------------------------------------------------------------------
          NET_FINGER:
          CMP DL,12
          JNE NET_FINGER1
          ;-------------------------------------------------------------------
          INC DH
          MOV DL,2
          NET_FINGER1:
          INC SI
         POP CX
     LOOP CIKL_FINGER
     RET
FINGER ENDP
;-----------------------------------------------------------------------------
;                                 ANALIZ          
;-----------------------------------------------------------------------------
ANALIZ PROC
       MOV SI,310H+OFFSET UCASATEL_SECTOR
       CMP 310H+SLOBO,0
       JE FIL
       ;----------------------------------------------------------------------
       MOV 310H+FLAG,1
       MOV AX,310H+SLOBO
       MOV WORD PTR CS:[SI],AX     
       JMP EXIT_ANALIZ
       ;----------------------------------------------------------------------
       FIL:
       XOR AL,AL
       MOV 310H+FLAG,AL
       XOR AX,AX
       MOV 310H+UCASATEL_SECTOR,AX
       ;----------------------------------------------------------------------
       EXIT_ANALIZ:
                   RET
ANALIZ ENDP
;-----------------------------------------------------------------------------
POISK_FAT PROC
         MOV AL,0
         MOV 310H+ONE_P,AL
         MOV 310H+I_P,AL
         MOV 310H+FLAG_FAT,AL
         ;-----------------
         MOV CX,310H+X
         MOV AX,0
         MOV SI,310H+OFFSET MOSK
         CIFER:           
            MOV WORD PTR CS:[SI],AX
            ADD SI,2
         LOOP CIFER
         ;--------------------------------------------------------------------
         MOV DI,310H+OFFSET MOSK
         MOV SI,310H+OFFSET FAT
         MOV CX,2880                    
         CIKL_POISK_FAT:
               MOV AL,CS:[SI]
               CMP AL,1
               JE NET_MOSK
               ;--------------------------------------------------------------
               MOV CS:[DI],SI     
               ADD DI,2
               ;-------
               DEC 310H+X
               XOR AX,AX
               CMP 310H+X,AX
               JE OK_FILE
               ;--------------------------------------------------------------
               NET_MOSK:
                    INC SI                                    
         LOOP CIKL_POISK_FAT
         ;--------------------------------------------------------------------
         MOV 310H+FLAG_POISK_FAT,0
         JMP END_FAT
         ;--------------------------------------------------------------------
         OK_FILE:
         MOV AL,1
         MOV 310H+FLAG_POISK_FAT,AL              
         ;--------------------------------------------------------------------
         END_FAT:
                 RET
POISK_FAT ENDP
;-----------------------------------------------------------------------------
FAT_WRITE PROC
         XOR AX,AX
         MOV 310H+JIK,AX
         ;------------
         MOV CX,6
         MOV AX,2                             
         MOV 310H+SECTOR_MAS,AX 
         CIKL_FAT_WRITE:
                        PUSH CX
                        ;------
                        CALL SECTOR          
                        CALL WRITE_SECTOR    
                        ADD 310H+JIK,512
                        ;-------------
                        MOV AX,310H+SECTOR_MAS
                        INC AX             
                        MOV 310H+SECTOR_MAS,AX 
                        ;-------------------
                        POP CX
         LOOP CIKL_FAT_WRITE        
         RET
FAT_WRITE ENDP
;-----------------------------------------------------------------------------
CREATE_NEW_SECTOR PROC
          MOV AX,0
          MOV 310H+WI,AX
          ;------------------- 
          MOV SI,310H+OFFSET FAT
          MOV CX,2880  
          MOV AL,0
          ;------------------------
          CIKL_NEW_MAS_SECTOR_MAS1:
                 CMP CS:[SI],AL
                 JE OK
                 ;------------------------------------------------------------
                 INC SI
                 INC 310H+WI                     
          LOOP CIKL_NEW_MAS_SECTOR_MAS1
          ;----------------------------  
          MOV 310H+FLAG_NEW_SECTOR,0                
          JMP EXIT_NEW_SECTOR
          ;-------------------------------------------------------------------
          ;-------------------------------------------------------------------
          OK: 
          MOV AX,310H+WI
          INC AX                                 
          MOV 310H+NEW_SECTOR,AX                     
          ;-------------------------------------------------------------------
          MOV SI,310H+OFFSET FAT
          DEC AX
          ADD SI,AX   
          MOV AL,1
          MOV CS:[SI],AL
          ;-------------
          MOV 310H+FLAG_NEW_SECTOR,1        
          EXIT_NEW_SECTOR:RET
CREATE_NEW_SECTOR ENDP
;-----------------------------------------------------------------------------
;
;                          óàíÄÖå íÄÅãàñì FAT Ç èÄåüíú
;
;-----------------------------------------------------------------------------
READ_FAT PROC
             MOV 310H+I,2
             MOV 310H+J,0
             ;----------------------------------------------------------------
             MOV AX,CS
             MOV ES,AX
             ;----------------------------------------------------------------
             MOV CX,6           
             CIKL_FAT_READ:
                           PUSH CX
                           ;--------------------------------------------------
                           MOV AH,02H
                           MOV AL,01       
                           MOV BX,310H+OFFSET FAT     
                           ADD BX,310H+J      
                           MOV CH,0         
                           MOV CL,310H+I   
                           MOV DH,0         
                           MOV DL,0       
                           INT 13H   
                           ADD 310H+J,512       
                           INC 310H+I            
                           ;--------------------------------------------------
                           POP CX
             LOOP CIKL_FAT_READ
             RET
READ_FAT ENDP
;-----------------------------------------------------------------------------
;
;                         PROVERENNIE PROCEDURI
;
;-----------------------------------------------------------------------------
SECTOR PROC
      MOV AX,310H+SECTOR_MAS
      MOV BX,AX
      CMP AX,1440
      JG STOR_ONE
      ;-----------------------------------------------------------------------
      MOV 310H+STOR,0
      MOV CL,18
      DIV CL    
      CMP AH,0  
      JNE NET_OST
      ;-----------------------------------------------------------------------
      DEC AX  
      MOV 310H+DOR,AL
      MOV DL,18
      MOV 310H+SECT,DL
      JMP EXIT_SECTOR   
      ;-----------------------------------------------------------------------
      NET_OST:
      MOV 310H+DOR,AL
      MOV 310H+SECT,AH   
      JMP EXIT_SECTOR
      ;-----------------------------------------------------------------------
      STOR_ONE:
      MOV 310H+STOR,1
      SUB AX,1440
      MOV CL,18
      DIV CL  
      CMP AH,0 
      JNE NET_OST1
      ;-----------------------------------------------------------------------
      DEC AX                                                    
      MOV 310H+DOR,AL
      MOV DL,18
      MOV 310H+SECT,DL
      JMP EXIT_SECTOR                                       
      ;-----------------------------------------------------------------------
      NET_OST1:                                                
      MOV 310H+DOR,AL
      MOV 310H+SECT,AH
      EXIT_SECTOR:RET
SECTOR ENDP
;-----------------------------------------------------------------------------
READ_MEMORY PROC
    XOR AX,AX
    MOV 310H+J,AX    
    MOV AX,310H+UK                                         
    CIKL_MEMORY:
       MOV  310H+SECTOR_MAS,AX           
       CALL SECTOR                     
       CALL READ_SECTOR                
       CALL ANALIZ                      
       CMP  310H+FLAG,1
       JNE EXIT_MEMORY
       ;----------------------------------------------------------------------
       MOV AX,310H+UCASATEL_SECTOR      
       ADD 310H+J,512                   
    JMP CIKL_MEMORY
    EXIT_MEMORY:
    RET
READ_MEMORY ENDP
;-----------------------------------------------------------------------------
OCHISTKA_MAS PROC
            MOV SI,310H+OFFSET MAS
            MOV CX,10000
            XOR AL,AL
            CIKL_MAS_OCHISTKA:
                    MOV CS:[SI],AL
                    INC SI
            LOOP CIKL_MAS_OCHISTKA
            RET
OCHISTKA_MAS ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
WRITE_MAS_NEW_SECTORA PROC
                   MOV AX,310H+I_FOLD
                   MOV BL,2
                   DIV BL 
                   ;------------------AX=CHISLO ZAPIS SECTOROV----------------
                   MOV CX,AX
                   ;--------
                   XOR AX,AX
                   MOV 310H+JIK,AX
                   ;-------------------
                   MOV SI,310H+OFFSET FOLDER_MAS
                   CIKL_WRITE_OLD:
                        PUSH CX
                        MOV AX,WORD PTR CS:[SI]
                        ADD SI,2
                        PUSH SI
                        ;-------------------
                        MOV 310H+SECTOR_MAS,AX
                        CALL SECTOR
                        CALL WRITE_SECTOR_OLD
                        ;--------------------
                        POP SI
                        POP CX
                   LOOP CIKL_WRITE_OLD
                   RET
WRITE_MAS_NEW_SECTORA ENDP    
;-----------------------------------------------------------------------------
WRITE_SECTOR_OLD PROC
       PUSH CS
       POP ES
       ;--------
       MOV AH,03
       MOV AL,01        
       MOV DI,310H+OFFSET MAS
       ADD DI,310H+JIK    
       MOV BX,DI        
       MOV CH,310H+DOR   
       MOV CL,310H+SECT  
       MOV DH,310H+STOR   
       MOV DL,00        
       INT 13H  
       ;---------
       MOV AX,512
       ADD 310H+JIK,AX
       RET
WRITE_SECTOR_OLD ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
FOLDER_CREATE PROC  
             XOR AX,AX
             MOV 310H+I_FOLD,AX
             MOV 310H+FLAG_PROVERKA_FOLDER,AL                  
             ;----------------------------------------------------------------
             MOV SI,310H+OFFSET FOLDER_MAS
             MOV AX,310H+UK           
             MOV WORD PTR CS:[SI],AX
             MOV AX,2           
             ADD 310H+I_FOLD,AX              
             ;----------------------------------------------------------------
             MOV AL,0
             MOV 310H+I,AL 
             MOV 310H+FLAG_ONE,AL      
             MOV SI,310H+OFFSET MAS
             CIKL_FOLDER:
                     MOV AL,0
                     CMP CS:[SI],AL
                     JE OK_FOLDER
                     ;--------------------------------------------------------
                     MOV AL,1
                     MOV 310H+FLAG_ONE,AL 
                     ;--------------------------------------------------------  
                     ADD SI,10
                     INC 310H+I                
                     ;--------------------------------------------------------
                     CALL PROVERKA          
             JMP CIKL_FOLDER 
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             OK_FOLDER:
             MOV AL,0
             CMP 310H+I,AL
             JNE NET_NEW_SECTOR_FOR_FOLDER
             ;----------------------------
             CMP 310H+FLAG_ONE,AL
             JE NET_NEW_SECTOR_FOR_FOLDER
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
                 MOV AL,1
                 MOV 310H+FLAG_PROVERKA_FOLDER,AL
             NET_NEW_SECTOR_FOR_FOLDER:
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             MOV CX,8
             MOV DI,310H+OFFSET NAMER
             CIKL_NAME_FOLDER:
                       MOV AL,CS:[DI]
                       MOV CS:[SI],AL
                       INC SI
                       INC DI
             LOOP CIKL_NAME_FOLDER
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;---------------------------------------------------------------- 
             PUSH SI
               CALL CREATE_NEW_SECTOR 
             POP SI    
             MOV AL,1
             CMP 310H+FLAG_NEW_SECTOR,AL       
             JNE NET_NEW_SECTOR
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             MOV AX,310H+NEW_SECTOR
             MOV WORD PTR CS:[SI],AX            
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             MOV AL,1
             CMP 310H+FLAG_PROVERKA_FOLDER,AL 
             JNE NET_NEW_FOLDER
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             PUSH SI
               CALL CREATE_NEW_SECTOR
             POP SI
             MOV AL,1
             CMP 310H+FLAG_NEW_SECTOR,AL                 
             JNE NET_NEW_SECTOR
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;ëÖâóÄë SI_TEC:   8 SECTOR:INFO(510) ? 1 PAPKA(8),SI_TEC(2)
             ; ? - ìäÄáÄíÖãú ÉãÄÇçéâ äéêçÖÇéâ èÄèäà çÄ ëãÖÑ ëÖäíéê
             SUB SI,8
             SUB SI,2  ;íÖèÖêú åõ ëûÑÄ èàïÄÖå çÄò ÄÑêÖë
             MOV AX,310H+NEW_SECTOR
             MOV WORD PTR CS:[SI],AX
             ;---------------------------
             MOV SI,310H+OFFSET FOLDER_MAS
             MOV AX,2
             SUB 310H+I_FOLD,AX
             ADD SI,310H+I_FOLD
             MOV AX,310H+NEW_SECTOR
             MOV WORD PTR CS:[SI],AX    
             ;----------------------
             MOV AX,2
             ADD 310H+I_FOLD,AX      
             ;----------------------------------------------------------------
             CALL WRITE_MAS_NEW_SECTORA 
             CALL FAT_WRITE                            
             JMP NET_NEW_SECTOR                
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             ;----------------------------------------------------------------
             NET_NEW_FOLDER:
             CALL WRITE_MAS_NEW_SECTORA 
             CALL FAT_WRITE                                     
             ;----------------------------------------------------------------
             NET_NEW_SECTOR:RET 
FOLDER_CREATE ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
PROVERKA PROC  
           MOV AL,310H+I
           CMP AL,51
           JNE EXIT
              ;---------------------------------------------------------------
              MOV AX,WORD PTR CS:[SI]
              MOV 310H+TEC_UK,AX
              ;----------------------------------------------------------------------
              XOR AL,AL
              MOV 310H+I,AL  
              ADD SI,2
              ;---------------------------------------------------------------
              PUSH SI
                MOV SI,310H+OFFSET FOLDER_MAS
                ADD SI,310H+I_FOLD
                MOV AX,310H+TEC_UK  
                MOV WORD PTR CS:[SI],AX
                MOV AX,2
                ADD 310H+I_FOLD,AX
              POP SI
           EXIT:               
           RET
PROVERKA ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;            áÄèàëú Ç èÄåüíú íÖäìôÖÉé ìäÄáÄíÖãü çÄ ãûÅìû èÄèäì  (ÇïéÑ UK)
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
PRED_UK_MEMORY PROC
            MOV SI,310H+OFFSET PAPKI
            ADD SI,310H+PAP                                     ;ëóÖíóàä èÄèéä
            MOV AX,310H+UK                                     ;ÇïéÑçõÖ ÑÄççõÖ
            MOV WORD PTR CS:[SI],AX
            MOV AX,2
            ADD 310H+PAP,2               ;èêéÑÇàÉÄÖåëü ÑÄãúòÖ èé åÄëëàÇì PAPKI
            RET
PRED_UK_MEMORY ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;èé çéåÖêì Ç ëèàëäÖ ÇõÑÄÖí ìäÄáÄíÖãú çÄ èÄèäì, çÄ äéíéêìû çÄÜÄãà (ÇõïéÑ AX ìä)
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
POISK_AX_UKAZATAL PROC
            XOR AL,AL
            MOV 310H+ID,AL
            ;---------------
            MOV AX,310H+AX_PAP
            MOV CX,AX
            DEC CX                      ;íÄä äÄä åõ óàíÄÖå çÖ N èÄèéä, Ä (N-1)
            ;-----------------------------------------------------------------
            MOV SI,310H+OFFSET MAS
            CMP CX,0
            JE ALL_10_BAIT
            ;---------------çÖí, Ç äéêçÖÇéâ èÄèäÖ ÅéãúòÖ éÑçéâ èÄèäà----------            
            CIKL_POISK_AX_UKAZATAL:
                                   PUSH CX
                                   ADD SI,10
                                   INC 310H+ID                    
                                   CALL ADD_2_BAIT
                                   POP CX
            LOOP CIKL_POISK_AX_UKAZATAL
            ;-----------------------------------------------------------------
            ALL_10_BAIT:
            ADD SI,8                               ;èêéòãà àåü èÄèäà àãà îÄâãÄ
            MOV AX,WORD PTR CS:[SI]
            ;--------------------áÄèéåàçÄÖå UKI-------------------------------
            MOV 310H+UKI,AX
            RET
POISK_AX_UKAZATAL ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;         ÇéëëíÄçÄÇãàÇÄÖå ìäÄáÄíÖãú (ÇõïéÑ AX=ìä. çÄ êéÑàíÖãúëäìû èÄèäì)
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
SLED_UK_MEMORY PROC
           MOV SI,310H+OFFSET PAPKI
           MOV AX,310H+PAP
           SUB AX,2
           MOV 310H+PAP,AX
           ;------------------------------------------------------------------
           ADD SI,AX
           MOV AX,WORD PTR CS:[SI]
           RET
SLED_UK_MEMORY ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
WRITE_SECTOR PROC
       PUSH CS
       POP ES
       ;--------
       MOV AH,03
       MOV AL,01        
       MOV DI,310H+OFFSET FAT
       ADD DI,310H+JIK    
       MOV BX,DI       
       MOV CH,310H+DOR    
       MOV CL,310H+SECT   
       MOV DH,310H+STOR   
       MOV DL,00       
       INT 13H   
       RET
WRITE_SECTOR ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
ADD_2_BAIT PROC                      
           MOV AL,310H+ID
           CMP AL,51
           JNE EXIT_ADD_2_BAIT
           ;------------------------------------------------------------------
           XOR AL,AL
           MOV 310H+ID,AL  
           ADD SI,2
           ;---------------
           EXIT_ADD_2_BAIT:               
           RET
ADD_2_BAIT ENDP
;-----------------------------------------------------------------------------
;
;
;
;                           éíãÄÜÖççõÖ èêéñÖÑìêõ         
;
;
;
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                  +    èêéÇÖêäÄ çÄ ÇÇÖêï àãà Ççàá    +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
BN_OR_BB PROC
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////
              ;            èêéÇÖêäÄ çÄ äÄíÄãéÉ - äéêçÖÇéâ àãà çÖí
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              CMP 310H+DH_KOREN_OR_NE_KOREN,2
              JE ES_KOR
                       JMP NEAR:NET_KOR
              ES_KOR:
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////
              ;         +     åõ çÄïéÑàåëü Ç ÉãÄÇçéå äÄíÄãéÉÖ     +
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------
              ;                     èêéÇÖêäÄ BNIZ   
              ;---------------------------------------------------------------
              CMP AH,50H
              JNE NET@_BNIZ
              ;---------------------------------------------------------------                  
              ;                     ÑÄ, çÄÜÄãà Ççàá  
              ;---------------------------------------------------------------
              CALL MAS_NUMBER                     
              MOV AX,310H+M
              ADD AX,310H+M1
              INC AX                             
              ;------------
              CMP AX,310H+ROT
              JG NET@_BNIZ
              ;-----------ÑÄ, åéÜçé éèìëäÄíúëü Ççàá--------------------------- 
              MOV AX,310H+M1
              CMP AX,21
              JNE NUTE
                     ;-----------------------M1=21----------------------------
                     INC 310H+M
                     CALL PAPKA
                     JMP ROS
              NUTE:
              INC 310H+M1
              ;--------
              ROS:
                 MOV AL,22
                 CMP 310H+DH_PIC,AL
                 JGE NET@_BNIZ
                          INC 310H+DH_PIC
                          CALL PIC_DOWN
                          CALL STIR_PIC_DOWN
                          JMP NEAR:EXIT_BN_OR_BB
              NET@_BNIZ:
              ;---------------------------------------------------------------                      
              ;                      èêéÇÖêäÄ ÇÇÖêï
              ;---------------------------------------------------------------
              CMP AH,48H
              JNE NET@_BBERH
              ;---------------------------------------------------------------                      
              ;                       ÑÄ, ÇÇÖêï
              ;---------------------------------------------------------------
              MOV AX,310H+M1
              CMP AX,1
              JNE NUTE@
                  ;----------M1=1-------------------------------------------------   
                  MOV AX,310H+M
                  CMP AX,0
                  JLE HOLI
                          DEC 310H+M
                          CALL PAPKA
                          JMP HOLI
              NUTE@:
                    DEC 310H+M1
              ;--------------
              HOLI:
                  MOV AL,2
                  CMP 310H+DH_PIC,AL
                  JLE NET@_BBERH
                          DEC 310H+DH_PIC
                          CALL PIC_UP
                          CALL STIR_PIC_UP
                  NET@_BBERH:
                          JMP NEAR:EXIT_BN_OR_BB
              NET_KOR:
              ;---------------------------------------------------------------
              ;///////////////////////////////////////////////////////////////
              ;              åõ çÖ çÄïéÑàåëü Ç ÉãÄÇçéå äÄíÄãéÉÖ
              ;///////////////////////////////////////////////////////////////
              ;---------------------------------------------------------------                      
              ;                     èêéÇÖêäÄ Ççàá
              ;---------------------------------------------------------------
              CMP AH,50H
              JNE NET_BNIZ@
              ;---------------------------------------------------------------
              ;                    ÑÄ, çÄÜÄãà Ççàá
              ;---------------------------------------------------------------
              CALL MAS_NUMBER                     
              MOV AX,310H+M
              ADD AX,310H+M1
              INC AX                             
              ;------------
              CMP AX,310H+ROT
              JG NET_BNIZ@
                          MOV AX,310H+M1
                          CMP AX,20
                          JNE NETE
                                  ;-----------M1=20---------------------------   
                                  INC 310H+M
                                  CALL PAPKA
                                  JMP ROS2
                          NETE:
                               INC 310H+M1  
                          ROS2:
                               CMP 310H+DH_PIC,22
                               JGE NET_BNIZ@
                                            INC 310H+DH_PIC
                                            CALL PIC_DOWN
                                            CALL STIR_PIC_DOWN 
                          JMP EXIT_BN_OR_BB      
              NET_BNIZ@:
              ;---------------------------------------------------------------                     
              ;                      èêéÇÖêäÄ ÇÇÖêï   
              ;---------------------------------------------------------------
              CMP AH,48H
              JNE NET_BBERH@
              ;---------------------------------------------------------------                      
              ;                    ÑÄ, çÄÜÄãà ÇÇÖêï 
              ;---------------------------------------------------------------
              MOV AX,310H+M1
              CMP AX,0
              JNE NETE@
                       ;--------M1=0------------------------------------------   
                       MOV AX,310H+M
                       CMP AX,0
                       JLE HOL
                              DEC 310H+M
                              CALL PAPKA
                              JMP HOL
              NETE@:
                    DEC 310H+M1
              HOL:
                  CMP 310H+DH_PIC,2
                  JLE NET_BBERH@
                                DEC 310H+DH_PIC
                                CALL PIC_UP
                                CALL STIR_PIC_UP
                  NET_BBERH@:
              EXIT_BN_OR_BB:RET
BN_OR_BB ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;         +   óíÖçàÖ ëÖäíéêÄ èé áÄÑÄççõå çÄóÄãúçõå èÄêÄåÖíêÄå    +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
READ_SECTOR PROC
       MOV AX,CS
       MOV ES,AX
       ;---------
       MOV AH,02H
       MOV AL,01        
       MOV BX,310H+OFFSET MAS
       ADD BX,310H+J      
       MOV CH,310H+DOR 
       MOV CL,310H+SECT   
       MOV DH,310H+STOR   
       MOV DL,00     
       INT 13H   
       ;----------------------------------------------------------------------
       MOV SI,310H+OFFSET MAS
       ADD SI,310H+J
       ADD SI,510
       MOV AX,WORD PTR CS:[SI]
       MOV 310H+SLOBO,AX
       RET
READ_SECTOR ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////        
;              +     éèêÖÑÖãüÖå äéãàóÖëíÇé îÄâãéÇ Ç èÄèäÖ     +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
MAS_NUMBER PROC
          ;-------------------------------------------------------------------
          XOR AX,AX
          MOV 310H+ROT,AX
          MOV AL,0
          MOV 310H+ID,AL
          ;-------------------------------------------------------------------
          MOV SI,310H+OFFSET MAS
          CIKL_GOK:
             MOV AL,CS:[SI]
             CMP AL,0
             JE EXIT_MAS_NUMBER
             ;----------------------------------------------------------------
             INC 310H+ROT
             ADD SI,10
             INC 310H+ID
             CALL ADD_2_BAIT
             ;----------------------------------------------------------------
          JMP CIKL_GOK
          EXIT_MAS_NUMBER:RET
MAS_NUMBER ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;        +   èêéñÖÑìêÄ äéååÄçÑçéâ ëíêéäà çÄ ëéáÑÄçàÖ çéÇéâ èÄèäà   +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
PROVERKA_CREATE_FOLDER PROC
              JMP DATA1
                 CR_NEW_F DB 'NEWF '         ;äéååÄçÑÄ çÄ ëéáÑÄçàÖ çéÇéâ èÄèäà
                 FLAG_PROVERKA_CREATE_FOLDER DB 0       ;îãÄÉ ÑÄççéâ èêéñÖÑìêõ
              DATA1:
              ;---------------------------------------------------------------
              MOV DI,310H+OFFSET CR_NEW_F
              MOV SI,310H+OFFSET BUFER_COM
              MOV CX,5
              CIKL_SRAVN_NEW_F:
                        MOV AL,CS:[SI]
                        CMP AL,CS:[DI]
                        JNE NET_NEW_F
                        ;---------èêéÑéãÜÄÖå ëêÄÇçàÇÄíú-----------------------
                        INC SI
                        INC DI
              LOOP CIKL_SRAVN_NEW_F
              ;---------------------------------------------------------------
              ;------ÑÄ, åõ ëéáÑÄÖå èÄèäì Ç ìäÄáÄççéâ ÑàêÖäíéêàà--------------
              ;---------------------------------------------------------------
              MOV 310H+FLAG_PROVERKA_CREATE_FOLDER,1
              ;-----------èÖêÇõÖ 8 ÅÄâí ÅìÑìí çÄáÇÄçàÖå èÄèäà-----------------
              MOV CX,8
              MOV DI,310H+OFFSET NAMER
              CIKL_COPY_NAMER_NEW_F:
                      MOV AL,CS:[SI]
                      MOV CS:[DI],AL
                      INC SI
                      INC DI
              LOOP CIKL_COPY_NAMER_NEW_F
              JMP EXIT_PROVERKA_CREATE_FOLDER
              ;---------------------------------------------------------------
              ;-------åõ çÖ ëéáÑÄÖå èÄèäì Ç ìäÄáÄççéâ ÑàêÖäíéêàà--------------
              ;---------------------------------------------------------------
              NET_NEW_F:
                       MOV 310H+FLAG_PROVERKA_CREATE_FOLDER,0
                       EXIT_PROVERKA_CREATE_FOLDER:
              ;---------------------------------------------------------------
              ;-----------------éóàôÄÖå ÅìîÖê COM-----------------------------
              ;---------------------------------------------------------------
              MOV CX,60
              MOV SI,310H+OFFSET BUFER_COM
              MOV 310H+UKBUL,0
              MOV AL,0
              CIKL_NAM@:
                      MOV CS:[SI],AL
                      INC SI
              LOOP CIKL_NAM@
              ;---------------------------------------------------------------
              ;---------éóàôÄÖå äéååÄçÑçìû ëíêéäì-----------------------------
              ;---------------------------------------------------------------
              MOV CX,60
              MOV DH,24
              MOV DL,8
              MOV SI,310H+OFFSET BUFER_COM
              CIKL_COMM_DEL:         
                        PUSH CX                       
                          MOV AL,0
                          MOV CS:[SI],AL
                          MOV AL,20H
                          MOV AH,7
                          MOV CX,1
                          CALL SIMBOL
                          INC SI
                          INC DL
                        POP CX 
              LOOP CIKL_COMM_DEL
              RET
PROVERKA_CREATE_FOLDER ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                 +       ÇõÇéÑ íêéÖíéóàü çÄ ùäêÄç       +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
NIL_FILE PROC
      MOV SI,310H+OFFSET STROL
      MOV DH,2
      MOV DL,2
      MOV CX,6
      MOV AH,7
      CIKL_NIL_FILE:
            PUSH CX
              MOV AL,CS:[SI]
              CALL SIMBOL
              INC DL
              INC SI
            POP CX
      LOOP CIKL_NIL_FILE
      RET
NIL_FILE ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;            +     ÇõÇéÑ Ç ëíêéäÖ 310H+PIKI ìäÄáÄíÖãü çÄ îÄâã     +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
PIKI_PROC PROC                   
         MOV DH,310H+PIKI
         MOV DL,1
         MOV CX,1
         MOV AL,1AH
         MOV AH,7
         CALL SIMBOL
         RET
PIKI_PROC ENDP
;-----------------------------------------------------------------------------
PIKI_PROC_STIR PROC
         MOV DH,310H+PIKI
         MOV DL,1
         MOV CX,1
         MOV AL,20H
         MOV AH,7
         CALL SIMBOL
         RET
PIKI_PROC_STIR ENDP
;-----------------------------------------------------------------------------
PIC_UP PROC
         MOV DH,310H+DH_PIC
         MOV DL,1
         MOV CX,1
         MOV AL,1AH
         MOV AH,7
         CALL SIMBOL                   
    RET
PIC_UP ENDP
STIR_PIC_UP PROC
         MOV DH,310H+DH_PIC
         INC DH
         MOV DL,1
         MOV CX,1
         MOV AL,20H
         MOV AH,7
         CALL SIMBOL                   
    RET
STIR_PIC_UP ENDP
;-----------------------------------------------------------------------------
PIC_DOWN PROC
         MOV DH,310H+DH_PIC
         MOV DL,1
         MOV CX,1
         MOV AL,1AH
         MOV AH,7
         CALL SIMBOL                   
    RET
PIC_DOWN ENDP
STIR_PIC_DOWN PROC
         MOV DH,310H+DH_PIC
         DEC DH
         MOV DL,1
         MOV CX,1
         MOV AL,20H
         MOV AH,7
         CALL SIMBOL                   
    RET
STIR_PIC_DOWN ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                       +      ÇõÇéÑ 22 èÄèéä     +
;/////////////////////////////////////////////////////////////////////////////                      
;-----------------------------------------------------------------------------
USER_31_FOLDER PROC
        XOR AL,AL
        MOV 310H+ID,AL   ;ÑéèéãçàíÖãúçõâ àÑÖçíàîàäÄíéê Ñãü ADD_2_BAIT
        MOV SI,310H+OFFSET MAS
        MOV BP,310H+OFFSET MAS_COPY
        ;---------------------------------------------------------------------
        ;-äéèàêìÖå Ç èÄåüíú MAS_COPY ëéÑÖêÜàåéÖ äÄíÄãéÉÄ - áÄíÖå ÇõÇéÑàå ÖÉé--
        ;---------------------------------------------------------------------
        CIKL_JMP:
                 MOV AL,CS:[SI]
                 CMP AL,0
                 JE OKL
                 ;-----
                 PUSH SI
                 PUSH BP
                 MOV CX,10
                 CIKL_JMP@:
                           MOV AL,CS:[SI]
                           MOV CS:[BP],AL
                           INC BP
                           INC SI
                 LOOP CIKL_JMP@           
                 ;-------------
                 POP BP
                 POP SI
                 ADD SI,10
                 ADD BP,10
                 INC 310H+ID
                 CALL ADD_2_BAIT
                 ;--------------
        JMP CIKL_JMP
        OKL:
        ;---------------------------------------------------------------------
        ;--------------------ÇõÇéÑ èÄèéä çÄ ùäêÄç-----------------------------
        ;---------------------------------------------------------------------
        MOV SI,310H+OFFSET MAS_COPY
        MOV AX,310H+M
        CMP 310H+DH_KOREN_OR_NE_KOREN,2
        JE ES_KOR@
                  DEC AX
        ES_KOR@:      
        MOV BL,10
        MUL BL                                                       ;AX=AX*10
        ADD SI,AX                      ;èêàÅÄÇãüÖå, ë äÄäéÉé ëåÖôÖçàü ÇõÇéÑàíú
        ;---------------------------------------------------------------------
        XOR AX,AX 
        MOV DH,2
        MOV CX,21                       ;ÇõÇéÑàå 21 èÄèäì çÄ ùäêÄç + íêéÖíéóàÖ
        CIKL_OTO:
                 PUSH CX
                 ;-------
                 MOV CX,8
                 MOV DL,2
                 PUSH SI
                 CIKL_OP@:
                          PUSH CX
                            MOV AH,7
                            MOV AL,CS:[SI]
                            MOV CX,1
                            CALL SIMBOL
                            INC SI
                            INC DL
                          POP CX                    
                 LOOP CIKL_OP@
                 ;------------
                 POP SI
                 ADD SI,10
                 INC DH
                 ;-----
                 POP CX
        LOOP CIKL_OTO
        RET
USER_31_FOLDER ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                      +       ÇõÇéÑ 21 èÄèäà      +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
USER_30_FOLDER PROC                                 
      MOV SI,310H+OFFSET MAS                       
      MOV DH,310H+DH_KOREN_OR_NE_KOREN   ;Ç áÄëàëàåéëíà éí íéÉé äéêÖçú àãà çÖí                                    
      MOV CX,20                          ;ÇõÇéÑàíú 20 îÄâãéÇ çÄ ùäêÄç                                          
      CIKL_USER_30_FOLDER:
                 ;------
                 PUSH CX
                 MOV CX,8                       
                 MOV DL,2                         
                 PUSH SI
                 CIKL_USER_30_FOLDER@:
                            ;---------
                            PUSH CX
                              MOV AH,7
                              MOV AL,CS:[SI]
                              MOV CX,1
                              CALL SIMBOL
                            INC SI  ;èÖêÖïéÑàå ä ëãÖÑìûôÖâ ÅìäÇÖ
                            INC DL
                            POP CX
                 LOOP CIKL_USER_30_FOLDER@
                 ;------------------------
                 POP SI
                 ADD SI,10             ;àÑÖå ä ëãÖÑìûôÖâ èÄèäÖ
                 INC DH                ;èÖêÖïéÑàå çÄ ëãÖÑìûôìû ëíêéäì              
                 POP CX
                 ;-----
      LOOP CIKL_USER_30_FOLDER
      RET
USER_30_FOLDER ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;    +    ÇïéÑ 310H+KORE - äéêçÖÇÄü èÄèäÄ àãà çÖí  (1-áçÄóàí äéêçÖÇÄü)  +  
;/////////////////////////////////////////////////////////////////////////////               
;-----------------------------------------------------------------------------
PAPKA PROC
      CALL MAS_NUMBER  ;=>ROT - óàëãé îÄâãéÇ Ç èÄèäÖ
      CMP 310H+ROT,22
      JGE CHISLO_FAILOV_BOLSHE_21
      ;-----------------------------------------------------------------------
      ;---------------èêéÇÖêäÄ çÄ äéêçÖÇìû èÄèäì------------------------------
      ;-----------------------------------------------------------------------
      CMP 310H+KORE,1
      JE ES_KOREN_PAPKA@
               CALL NIL_FILE      ;çÖí, ùíé çÖ äéêçÖÇÄü èÄèäÄ, 3 íéóäà ëíÄÇàíú
               CALL USER_30_FOLDER
               JMP EXIT_PAPKA
      ES_KOREN_PAPKA@:
      ;-----------------------------------------------------------------------
      ;----------ÇõÇÖãà 22 èÄèäà Ç äéêçÖÇéå äÄíÄãéÉÖ--------------------------
      ;-----------------------------------------------------------------------
      CALL USER_31_FOLDER
      JMP EXIT_PAPKA
      ;-----------------------------------------------------------------------
      ;--------------óàëãé ëéáÑÄççõï îÄâãéÇ ÅéãúòÖ 21-------------------------
      ;-----------------------------------------------------------------------
      CHISLO_FAILOV_BOLSHE_21:
              ;---------------------------------------------------------------
              ;-----------èêéÇÖêäÄ çÄ äéêçÖÇìû èÄèäì--------------------------
              ;---------------------------------------------------------------
              CMP 310H+KORE,1
              JE ES_KOREN_PAPKA
                ;------------çÖí, ùíé çÖ äéêçÖÇÄü èÄèäÄ-----------------------
                CMP 310H+M,0
                JNE NETO
                   CALL NIL_FILE      
                   CALL USER_30_FOLDER
                   JMP EXIT_PAPKA
                ˇNETO:
                   CALL USER_31_FOLDER
                   JMP EXIT_PAPKA
              ES_KOREN_PAPKA:
              ;---------ÑÄ, ùíé äéêçÖÇÄü èÄèäÄ--------------------------------
              CALL USER_31_FOLDER
      EXIT_PAPKA:RET
PAPKA ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                        +    éóàëíäÄ íÖäìôÖÉé éäçÄ   +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
STIR_DISPLEI PROC
        MOV AX,0B800H
        MOV ES,AX
        ;---------------------------------------------------------------------
        MOV CX,21
        MOV DI,322
        CIKL_VERT:
                 PUSH CX
                 ;------------------------------------------------------------
                 MOV CX,78
                 CIKL_GOR:
                     MOV AH,7
                     MOV AL,0
                     MOV ES:[DI],AX
                     INC SI
                     ADD DI,2
                 LOOP CIKL_GOR
                 ;------------------------------------------------------------
                 POP CX
                 ADD DI,4
        LOOP CIKL_VERT
        RET
STIR_DISPLEI ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                           +        NAM       +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
NAM PROC
    MOV AX,0B800H
    MOV ES,AX
    MOV DI,76
    MOV SI,310H+OFFSET NAN
    MOV CX,4
    CIKL_NAM:
           MOV AH,7
           MOV AL,CS:[SI]
           MOV ES:[DI],AX
           ADD DI,2
           INC SI
    LOOP CIKL_NAM
    RET
NAM ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                        +           COMD          +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
COMD PROC
    MOV AX,0B800H
    MOV ES,AX
    MOV DI,3840
    MOV SI,310H+OFFSET COMER
    MOV CX,8
    CIKL_COMD:
           MOV AH,7
           MOV AL,CS:[SI]
           MOV ES:[DI],AX
           ADD DI,2
           INC SI
    LOOP CIKL_COMD
    RET
COMD ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                        +           EDIT        +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
EDIT_PROC PROC
         JMP EDIT_DATA
           UK_GOR DB 0                 ;ÉéêàáéçíÄãúçéÖ èéãéÜÖçàÖ äìêëéêÄ
           UK_VER DB 0                 ;ÇÖêíàäÄãúçéÖ èéãéÜÖçàÖ äìêëéêÄ
           UK_ED DW 0                  ;éÅôàâ ëóÖíóàä Ç èÄåüíà çÄ îÄâã
         EDIT_DATA:
         ;--------------------------------------------------------------------
         MOV DH,310H+UK_VER
         MOV DL,310H+UK_GOR
         ADD DH,2
         INC DL
         MOV CX,1
         MOV AL,95
         MOV AH,7
         CALL SIMBOL
         ;--------------------------------------------------------------------
         CIKL_EDIT:
              MOV AH,01H
              INT 16H
              JNZ ES_SIMBOL
                JMP NEAR:NET_SIMBOL
              ES_SIMBOL:
              ;----------ÑÄ, åõ çÄÜÄãà ëàåÇéã---------------------------------
              MOV AH,0
              MOV AL,0
              INT 16H                                                 
              ;---------------èêéÇÖêäÄ çÄ ÇõïéÑ-------------------------------
              CMP AL,27
              JNE NET_ESC
                JMP EXIT_EDIT
              NET_ESC:
              ;---------------èêéÇÖêäÄ çÄ BS----------------------------------
              CMP AL,8
              JNE NET_BS
                 ;-------------èêéÇÖêäÄ çÄ ñÖãéëíçéëíú------------------------
                 CMP 310H+UK_ED,0
                 JNE ES1
                   JMP NEAR:CIKL_EDIT
                 ES1:
                 ;------------------------------------------------------------
                 MOV CX,310H+UK_ED
                 DEC CX
                 MOV 310H+UK_ED,CX
                 LEA DI,310H+BUFER_EDIT
                 ADD DI,CX
                 XOR AL,AL
                 MOV 310H+[DI],AL
                 ;------------------------------------------------------------                 
                 CMP 310H+UK_GOR,0
                 JNE NET_GOR1
                    MOV 310H+UK_GOR,78
                    DEC 310H+UK_VER
                 NET_GOR1:
                 DEC 310H+UK_GOR
                 JMP CURSOR
              NET_BS:                 ˇˇˇˇˇ ˇˇ
              ;---------------èêéÇÖêäÄ çÄ ãÖÇé--------------------------------
              CMP AH,4BH
              JNE NET_LEV
                 ;-------------èêéÇÖêäÄ çÄ ñÖãéëíçéëíú------------------------
                 CMP 310H+UK_GOR,0
                 JNE ES2
                   JMP NEAR:CIKL_EDIT
                 ES2:
                 ;------------------------------------------------------------
                 DEC 310H+UK_ED
                 DEC 310H+UK_GOR
                 JMP CURSOR
              NET_LEV:
              ;---------------èêéÇÖêäÄ çÄ èêÄÇé-------------------------------
              CMP AH,4DH
              JNE NET_PRAV
                 ;-------------èêéÇÖêäÄ çÄ ñÖãéëíçéëíú------------------------
                 CMP 310H+UK_GOR,77
                 JNE ES3
                   JMP NEAR:CIKL_EDIT
                 ES3:
                 ;------------------------------------------------------------
                 INC 310H+UK_ED
                 INC 310H+UK_GOR
                 JMP CURSOR
              NET_PRAV:
              ;---------------èêéÇÖêäÄ çÄ BNIZ--------------------------------
              CMP AH,50H
              JNE NET_BNIZ
                 ;-------------èêéÇÖêäÄ çÄ ñÖãéëíçéëíú------------------------
                 CMP 310H+UK_VER,20
                 JNE ES4
                   JMP NEAR:CIKL_EDIT
                 ES4:
                 ;------------------------------------------------------------
                 ADD 310H+UK_ED,78
                 INC 310H+UK_VER
                 JMP CURSOR
              NET_BNIZ:
              ;---------------èêéÇÖêäÄ çÄ BBERH-------------------------------
              CMP AH,48H
              JNE NET_BBERH
                 ;-------------èêéÇÖêäÄ çÄ ñÖãéëíçéëíú------------------------
                 CMP 310H+UK_VER,0
                 JNE ES5
                   JMP NEAR:CIKL_EDIT
                 ES5:
                 ;------------------------------------------------------------
                 SUB 310H+UK_ED,78
                 DEC 310H+UK_VER
                 JMP CURSOR
              NET_BBERH:
              ;-------------èêéèàëõÇÄÖå ëàåÇéã Ç èÄåüíú-----------------------
              ;-------------èêéÇÖêäÄ çÄ ñÖãéëíçéëíú---------------------------
              CMP 310H+UK_ED,1637
              JNE ES6
                   JMP NEAR:CIKL_EDIT
              ES6:
              ;---------------------------------------------------------------
              MOV CX,310H+UK_ED
              LEA DI,310H+BUFER_EDIT
              ADD DI,CX
              MOV 310H+[DI],AL
              ;-------------            
              INC 310H+UK_GOR
              CMP 310H+UK_GOR,78
              JNE NET_GOR
                MOV 310H+UK_GOR,0
                INC 310H+UK_VER
              NET_GOR:
              ;-----------
              MOV CX,310H+UK_ED
              INC CX
              MOV 310H+UK_ED,CX
              ;---------------------------------------------------------------
              CURSOR:
                     CALL DISPLEI
                     MOV DH,310H+UK_VER
                     MOV DL,310H+UK_GOR
                     ADD DH,2
                     INC DL
                     MOV CX,1
                     MOV AL,95
                     MOV AH,7
                     CALL SIMBOL
              ;---------------------------------------------------------------
              NET_SIMBOL:
         JMP CIKL_EDIT
         EXIT_EDIT:
         RET
EDIT_PROC ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                      +         DISPLEI         +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
DISPLEI PROC
        ;---------------------------------------------------------------------
        MOV AX,0B800H
        MOV ES,AX
        ;---------------------------------------------------------------------
        MOV SI,310H+OFFSET BUFER_EDIT
        MOV CX,21
        MOV DI,322
        CIKL_VERT@:
                 PUSH CX
                 ;------------------------------------------------------------
                 MOV CX,78
                 CIKL_GOR@:
                     MOV AH,7
                     MOV AL,CS:[SI]
                     MOV ES:[DI],AX
                     INC SI
                     ADD DI,2
                 LOOP CIKL_GOR@
                 ;------------------------------------------------------------
                 POP CX
                 ADD DI,4
        LOOP CIKL_VERT@
        RET
DISPLEI ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                      +              SIMBOL           +
;çÄ ÇïéÑ:
;        DH - ëíêéäÄ
;        DL - ëíéãÅÖñ
;        CX - óàëãé èéÇíéêÖçàâ ëàåÇéãÄ
;        AL - äéÑ ëàåÇéãÄ
;        AH - ñÇÖí
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
SIMBOL PROC
       PUSH AX
        MOV AX,0B800H
        MOV ES,AX
       POP AX
       ;----------------------------------------------------------------------
       PUSH AX
        MOV AL,160
        MUL DH
        MOV BX,AX
        MOV AL,2
        MUL DL
        ADD BX,AX
        MOV DI,BX        
       POP AX
       ;----------------------------------------------------------------------
       CMP SIMBOL_FLAG,1
       JNE NET_SIMBOL_FLAG
       CIKL1:
             MOV ES:[DI],AX
             ADD DI,2
       LOOP CIKL1
       JMP EXIT_SIMBOL
       NET_SIMBOL_FLAG:
       ;----------------------------------------------------------------------
       CIKL2:
             MOV ES:[DI],AX
             ADD DI,160
       LOOP CIKL2
       ;----------------------------------------------------------------------
       EXIT_SIMBOL:RET
SIMBOL ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                            +        RAMA       +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
RAMA PROC 
     JMP DATA_RAMA
       SIMBOL_FLAG DB 0
     DATA_RAMA:
     ;------------------------------------------------------------------------
     MOV CX,78
     MOV DH,1  ;ëíêéäÄ
     MOV DL,1  ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,196
     MOV SIMBOL_FLAG,1
     CALL SIMBOL
     MOV CX,21
     MOV DH,2  ;ëíêéäÄ
     MOV DL,0  ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,179
     MOV SIMBOL_FLAG,0
     CALL SIMBOL
     MOV CX,21
     MOV DH,2  ;ëíêéäÄ
     MOV DL,79 ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,179
     MOV SIMBOL_FLAG,0
     CALL SIMBOL
     MOV CX,78
     MOV DH,23 ;ëíêéäÄ
     MOV DL,1  ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,196
     MOV SIMBOL_FLAG,1
     CALL SIMBOL
     ;------------------------------------------------------------------------
     MOV CX,1
     MOV DH,1   ;ëíêéäÄ
     MOV DL,79  ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,191
     MOV SIMBOL_FLAG,1
     CALL SIMBOL
     MOV CX,1
     MOV DH,23  ;ëíêéäÄ
     MOV DL,79  ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,217
     MOV SIMBOL_FLAG,1
     CALL SIMBOL
     MOV CX,1
     MOV DH,23   ;ëíêéäÄ
     MOV DL,0    ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,192
     MOV SIMBOL_FLAG,1
     CALL SIMBOL
     MOV CX,1
     MOV DH,1    ;ëíêéäÄ
     MOV DL,0    ;ëíéãÅÖñ
     MOV AH,7
     MOV AL,218
     MOV SIMBOL_FLAG,1
     CALL SIMBOL
     RET
RAMA ENDP     
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                            +        TIMER      +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
TIMER PROC
        MOV AL,00H
        MOV 310H+DL1,78
        CALL TIME    ;ëÖäìçÑÄ
        ;--------
        MOV AL,02H   ;åàçìíÄ 
        MOV 310H+DL1,75
        CALL TIME
        ;--------
        MOV 310H+DL1,72
        MOV AL,04H   ;óÄë
        CALL TIME     
        RET
TIMER ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                            +        TIMER       +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
TIME PROC
       OUT 70H,AL
       IN AL,71H   
       ;-----------------------ÇõÇéÑàå êÄáêüÑ ÑÖëüíéä-------------------------
       PUSH AX
         SHR AL,4                                       
         ADD AL,30H
         ;---------
         MOV DH,24
         MOV DL,310H+DL1
         MOV AH,7
         MOV CX,1
         CALL SIMBOL
       POP AX
       ;-----------------------ÇõÇéÑàå êÄáêüÑ ÖÑàçàñ--------------------------
         SHL AL,4
         SHR AL,4
         ADD AL,30H            
         ;---------
         MOV DH,24
         MOV DL,310H+DL1
         INC DL
         MOV AH,7
         MOV CX,1
         CALL SIMBOL
     RET
TIME ENDP
;-----------------------------------------------------------------------------
;/////////////////////////////////////////////////////////////////////////////
;                            +        DVET       +
;/////////////////////////////////////////////////////////////////////////////
;-----------------------------------------------------------------------------
DVET PROC
         MOV DH,24
         MOV DL,74
         MOV AH,7
         MOV CX,1
         MOV AL,3AH
         CALL SIMBOL
         MOV DH,24
         MOV DL,77
         MOV AH,7
         MOV CX,1
         MOV AL,3AH
         CALL SIMBOL
     RET
DVET ENDP
;-----------------------------------------------------------------------------
END START























